// crc4_itu.c : Defines the entry point for the console application.

/*-----------------------------------------------------------------
|  crc4_itu.c
|
|  Developed by: Zulhilmi Ramli
|
|  Purpose:  CRC4-ITU library using lookup table method. Was developed
|             on Visual Studio 2015.
|  
|  Notes: Some of variable used in this library might not compatible
|         when ported to other system/embedded system. 
|         Change it accordingly to target system.
|
|  Parameters:
|      parameter_name (IN, OUT, or IN/OUT) -- EXPLANATION OF THE
|              PURPOSE OF THIS PARAMETER TO THE FUNCTION.
|                      (REPEAT THIS FOR ALL FORMAL PARAMETERS OF
|                       THIS FUNCTION.
|                       IN = USED TO PASS DATA INTO THIS FUNCTION,
|                       OUT = USED TO PASS DATA OUT OF THIS FUNCTION
|                       IN/OUT = USED FOR BOTH PURPOSES.)
|
|  Returns:  IF THIS FUNCTION SENDS BACK A VALUE VIA THE RETURN
|      MECHANISM, DESCRIBE THE PURPOSE OF THAT VALUE HERE.
*-------------------------------------------------------------------*/

#include "stdafx.h"

/* Lookup table for CRC4-ITU */
static unsigned char const table_byte[256] = {
	0x0, 0x7, 0xe, 0x9, 0x5, 0x2, 0xb, 0xc, 0xa, 0xd, 0x4, 0x3, 0xf, 0x8, 0x1, 0x6,
	0xd, 0xa, 0x3, 0x4, 0x8, 0xf, 0x6, 0x1, 0x7, 0x0, 0x9, 0xe, 0x2, 0x5, 0xc, 0xb,
	0x3, 0x4, 0xd, 0xa, 0x6, 0x1, 0x8, 0xf, 0x9, 0xe, 0x7, 0x0, 0xc, 0xb, 0x2, 0x5,
	0xe, 0x9, 0x0, 0x7, 0xb, 0xc, 0x5, 0x2, 0x4, 0x3, 0xa, 0xd, 0x1, 0x6, 0xf, 0x8,
	0x6, 0x1, 0x8, 0xf, 0x3, 0x4, 0xd, 0xa, 0xc, 0xb, 0x2, 0x5, 0x9, 0xe, 0x7, 0x0,
	0xb, 0xc, 0x5, 0x2, 0xe, 0x9, 0x0, 0x7, 0x1, 0x6, 0xf, 0x8, 0x4, 0x3, 0xa, 0xd,
	0x5, 0x2, 0xb, 0xc, 0x0, 0x7, 0xe, 0x9, 0xf, 0x8, 0x1, 0x6, 0xa, 0xd, 0x4, 0x3,
	0x8, 0xf, 0x6, 0x1, 0xd, 0xa, 0x3, 0x4, 0x2, 0x5, 0xc, 0xb, 0x7, 0x0, 0x9, 0xe,
	0xc, 0xb, 0x2, 0x5, 0x9, 0xe, 0x7, 0x0, 0x6, 0x1, 0x8, 0xf, 0x3, 0x4, 0xd, 0xa,
	0x1, 0x6, 0xf, 0x8, 0x4, 0x3, 0xa, 0xd, 0xb, 0xc, 0x5, 0x2, 0xe, 0x9, 0x0, 0x7,
	0xf, 0x8, 0x1, 0x6, 0xa, 0xd, 0x4, 0x3, 0x5, 0x2, 0xb, 0xc, 0x0, 0x7, 0xe, 0x9,
	0x2, 0x5, 0xc, 0xb, 0x7, 0x0, 0x9, 0xe, 0x8, 0xf, 0x6, 0x1, 0xd, 0xa, 0x3, 0x4,
	0xa, 0xd, 0x4, 0x3, 0xf, 0x8, 0x1, 0x6, 0x0, 0x7, 0xe, 0x9, 0x5, 0x2, 0xb, 0xc,
	0x7, 0x0, 0x9, 0xe, 0x2, 0x5, 0xc, 0xb, 0xd, 0xa, 0x3, 0x4, 0x8, 0xf, 0x6, 0x1,
	0x9, 0xe, 0x7, 0x0, 0xc, 0xb, 0x2, 0x5, 0x3, 0x4, 0xd, 0xa, 0x6, 0x1, 0x8, 0xf,
	0x4, 0x3, 0xa, 0xd, 0x1, 0x6, 0xf, 0x8, 0xe, 0x9, 0x0, 0x7, 0xb, 0xc, 0x5, 0x2 
};

unsigned char data[] = { 0x1, 0x23, 0x45, 0x67, 0x89 }; // This variable only for testing purpose
unsigned char size = 5; // For testing only. Change according to data size.

/**
 * Main CRC4-ITU function
 * 
 * @param crc -> Existing CRC value before process a new one.
 * @param data -> Pointer to data to be hashed with CRC
 * @param len -> Size of data
 * @return -> CRC value.
 * @notes -> crc parameter most of time should be 0x00 as listed in ITU standard.
 */
static unsigned char crc4itu(unsigned char crc, unsigned char *data, unsigned char len) {
	if (data == NULL)
		return 0;
	crc &= 0xf;
	while (len--)
		crc = table_byte[crc ^ *data++];
	return crc;
}

int main()
{
	printf("CRC4-ITU Test\r\n");
	unsigned char crc = crc4itu(0x00, data, size);
	printf("Result is: %d \r\n", crc);
    return 0;
}


